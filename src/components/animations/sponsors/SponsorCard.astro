---
import { sponsorsInfo, type Sponsor } from "@/config/sponsorConfig";
import { Image } from "astro:assets";

const getCardClass = (value: number) =>
  [
    "lg:col-span-1 col-span-2",
    "col-span-1 lg:col-span-2",
    "col-span-3",
    "col-span-4",
  ][value - 1] || "";

const groupSponsors = (sponsors: Sponsor[]) =>
  sponsors
    .sort((a, b) => b.value - a.value)
    .reduce((groups, sponsor) => {
      const group =
        groups.find(
          (g) => g.reduce((sum, s) => sum + s.value, 0) + sponsor.value <= 4,
        ) || [];
      group.push(sponsor);
      if (!groups.includes(group)) groups.push(group);
      return groups;
    }, [] as Sponsor[][])
    .map((group) => ({
      sponsors: group,
      notFull: group.reduce((sum, s) => sum + s.value, 0) < 4,
    }))
    .sort(
      (a, b) =>
        b.sponsors.length - a.sponsors.length ||
        b.sponsors.reduce((sum, s) => sum + s.value, 0) -
          a.sponsors.reduce((sum, s) => sum + s.value, 0),
    );

const sponsorGroups = groupSponsors(sponsorsInfo);
---

<div class="container space-y-6 p-6">
  {
    sponsorGroups.map(({ sponsors, notFull }, index) => (
      <div
        id={`${index}`}
        class={`grid grid-cols-2 gap-4 lg:grid-cols-4 ${notFull ? "justify-center" : ""}`}
      >
        {sponsors.map((sponsor) => (
          <a
            href={sponsor.website}
            target="_blank"
            rel="noopener noreferrer"
            class={`group relative max-h-[300px] overflow-hidden rounded-3xl bg-orange-400 shadow-md transition-transform duration-300 ease-in-out hover:scale-105 ${getCardClass(sponsor.value)}`}
          >
            <div class="absolute inset-0 bg-gradient-to-br from-gray-900/80 to-gray-900/40 opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
            <Image
              src={sponsor.logoUrl}
              alt={`${sponsor.name} logo`}
              width={sponsor.value >= 3 ? 400 : 200}
              height={sponsor.value >= 3 ? 200 : 100}
              class="h-full w-full object-cover"
            />
            <div class="absolute inset-0 flex items-center justify-center p-4">
              <h3 class="text-center text-xl font-bold text-white opacity-0 transition-opacity duration-300 group-hover:opacity-100">
                {sponsor.name}
                {sponsor.value}
              </h3>
            </div>
          </a>
        ))}
      </div>
    ))
  }
</div>
