---
interface Props {
  question: string;
  answer: string;
}

const { question, answer } = Astro.props;
---

<li
  class="faq-item group relative cursor-pointer overflow-hidden rounded-md bg-white/30 p-4 transition-shadow duration-300"
>
  <button
    class="faq-question-container relative flex w-full cursor-pointer justify-between gap-2.5 text-left font-baloo font-semibold md:text-lg"
  >
    <span class="faq-question">{question}</span>
    <span class="faq-toggle text-lg md:text-xl">+</span>
  </button>
  <p
    class="faq-answer relative z-10 hidden w-full pt-4 text-slate-600 max-md:text-sm"
  >
    {answer}
  </p>

  <!-- Borders -->
  <div
    class="faq-border absolute bottom-0 left-0 right-0 hidden h-[2px] origin-center bg-red-950"
  >
  </div>
</li>

<script>
  import gsap from "gsap";

  const faqItems = document.querySelectorAll(".faq-item");
  faqItems.forEach((faqItem) => {
    faqItem.addEventListener("click", () => toggleFaq(faqItem));
  });

  function toggleFaq(faqItem: Element) {
    const answerElement = faqItem.querySelector(".faq-answer");
    const button = faqItem.querySelector(".faq-question-container");
    const toggleIcon = faqItem.querySelector(".faq-toggle");
    const faqBorder = faqItem.querySelector(".faq-border");

    if (!button || !answerElement || !toggleIcon || !faqBorder) return;

    // Accessibility
    const isExpanded = button.getAttribute("aria-expanded") === "true";
    button.setAttribute("aria-expanded", isExpanded ? "false" : "true");

    const tl = gsap.timeline();

    if (isExpanded) {
      // Close animations
      tl.to(toggleIcon, { rotate: 0, duration: 0.1 })
        .to(
          answerElement,
          {
            opacity: 0,
            scaleY: 0,
            duration: 0.2,
            height: 0,
            ease: "back.in",
            onComplete: () => {
              answerElement.classList.add("hidden");
            },
          },
          0,
        )
        .to(
          faqBorder,
          {
            scaleX: 0,
            duration: 0.2,
            ease: "power3.in",
            onComplete: () => {
              faqBorder.classList.add("hidden");
            },
          },
          0.2,
        )
        .to(
          faqItem,
          {
            boxShadow: "none",
            duration: 0.3,
            backgroundColor: "rgba(255, 255, 255, 0.3)",
          },
          "-=0.3",
        );
    } else {
      // Open animations
      faqBorder.classList.remove("hidden");
      tl.to(faqItem, {
        boxShadow: "0 0 20px rgba(0, 0, 0, 0.10)",
        backgroundColor: "rgba(255, 255, 255, 0.7)",
        duration: 0.1,
      })
        .fromTo(
          faqBorder,
          {
            scaleX: 0,
          },
          {
            scaleX: 1,
            duration: 0.1,
            ease: "power3.out",
            onComplete: () => {
              answerElement.classList.remove("hidden");
            },
          },
        )
        .fromTo(
          answerElement,
          {
            height: 0,
            opacity: 0,
            scaleY: 0.5,
          },
          {
            height: "auto",
            opacity: 1,
            scaleY: 1,
            duration: 0.2,
            ease: "back.out(1.5)",
          },
          0.2,
        )
        .to(toggleIcon, { rotate: 45, duration: 0.2 }, 0.2);
    }
  }
</script>
